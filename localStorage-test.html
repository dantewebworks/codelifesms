<!DOCTYPE html>
<html>
<head>
    <title>localStorage Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        input { padding: 8px; width: 300px; }
    </style>
</head>
<body>
    <h1>localStorage Diagnostic Test</h1>
    
    <div class="test">
        <h3>Test 1: Basic localStorage</h3>
        <input type="text" id="test1" placeholder="Enter any text">
        <button onclick="saveTest1()">Save</button>
        <button onclick="loadTest1()">Load</button>
        <button onclick="clearTest1()">Clear</button>
        <div id="result1"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Webhook URL Test</h3>
        <input type="text" id="test2" placeholder="Enter webhook URL">
        <button onclick="saveTest2()">Save</button>
        <button onclick="loadTest2()">Load</button>
        <button onclick="clearTest2()">Clear</button>
        <div id="result2"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: All localStorage Keys</h3>
        <button onclick="showAllKeys()">Show All Keys</button>
        <button onclick="clearAllKeys()">Clear All Keys</button>
        <div id="result3"></div>
    </div>
    
    <script>
        function log(elementId, message) {
            document.getElementById(elementId).innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        function saveTest1() {
            const value = document.getElementById('test1').value;
            try {
                localStorage.setItem('test1', value);
                log('result1', '‚úÖ Saved: ' + value);
            } catch (e) {
                log('result1', '‚ùå Save failed: ' + e.message);
            }
        }
        
        function loadTest1() {
            try {
                const value = localStorage.getItem('test1');
                document.getElementById('test1').value = value || '';
                log('result1', value ? '‚úÖ Loaded: ' + value : '‚ùå No value found');
            } catch (e) {
                log('result1', '‚ùå Load failed: ' + e.message);
            }
        }
        
        function clearTest1() {
            localStorage.removeItem('test1');
            document.getElementById('test1').value = '';
            document.getElementById('result1').innerHTML = '';
            log('result1', 'üóëÔ∏è Cleared');
        }
        
        function saveTest2() {
            const value = document.getElementById('test2').value;
            try {
                localStorage.setItem('telynxWebhookUrl', value);
                localStorage.setItem('webhookUrl', value);
                localStorage.setItem('webhook', value);
                log('result2', '‚úÖ Saved to 3 keys: ' + value);
            } catch (e) {
                log('result2', '‚ùå Save failed: ' + e.message);
            }
        }
        
        function loadTest2() {
            try {
                const value1 = localStorage.getItem('telynxWebhookUrl');
                const value2 = localStorage.getItem('webhookUrl');
                const value3 = localStorage.getItem('webhook');
                
                log('result2', 'telynxWebhookUrl: ' + (value1 || 'NONE'));
                log('result2', 'webhookUrl: ' + (value2 || 'NONE'));
                log('result2', 'webhook: ' + (value3 || 'NONE'));
                
                if (value1) {
                    document.getElementById('test2').value = value1;
                    log('result2', '‚úÖ Loaded into field: ' + value1);
                }
            } catch (e) {
                log('result2', '‚ùå Load failed: ' + e.message);
            }
        }
        
        function clearTest2() {
            localStorage.removeItem('telynxWebhookUrl');
            localStorage.removeItem('webhookUrl');
            localStorage.removeItem('webhook');
            document.getElementById('test2').value = '';
            document.getElementById('result2').innerHTML = '';
            log('result2', 'üóëÔ∏è Cleared all webhook keys');
        }
        
        function showAllKeys() {
            const result = document.getElementById('result3');
            result.innerHTML = '<h4>All localStorage keys:</h4>';
            
            if (localStorage.length === 0) {
                result.innerHTML += '<div>‚ùå No keys found in localStorage</div>';
                return;
            }
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                result.innerHTML += '<div><strong>' + key + ':</strong> ' + (value.length > 50 ? value.substring(0, 50) + '...' : value) + '</div>';
            }
        }
        
        function clearAllKeys() {
            localStorage.clear();
            document.getElementById('result3').innerHTML = '<div>üóëÔ∏è All localStorage cleared</div>';
        }
        
        // Auto-load on page start
        window.onload = function() {
            log('result1', 'üöÄ localStorage test loaded');
            
            // Check if localStorage is available
            if (typeof(Storage) !== "undefined") {
                log('result1', '‚úÖ localStorage is supported');
            } else {
                log('result1', '‚ùå localStorage is NOT supported');
            }
            
            // Try to load existing values
            loadTest1();
            loadTest2();
        };
    </script>
</body>
</html>